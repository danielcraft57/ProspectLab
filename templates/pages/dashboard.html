{% extends "base.html" %}
{% from 'components/page_header.html' import page_header %}
{% from 'components/stats_grid.html' import stats_grid %}

{% block title %}Dashboard - ProspectLab{% endblock %}

{% block content %}
{{ page_header('Dashboard', 'Vue d\'ensemble de votre pipeline et de vos campagnes') }}

{# Ligne 1 : pipeline prospects #}
{{ stats_grid([
    {'id': 'stat-total-entreprises', 'label': 'Entreprises en base'},
    {'id': 'stat-actifs', 'label': 'Prospects actifs'},
    {'id': 'stat-gagnes', 'label': 'Prospects gagnés'},
    {'id': 'stat-conversion', 'label': 'Taux de conversion'}
]) }}

{# Ligne 2 : performance emailing #}
{{ stats_grid([
    {'id': 'stat-emails-envoyes', 'label': 'Emails envoyés'},
    {'id': 'stat-open-rate', 'label': 'Taux d\'ouverture'},
    {'id': 'stat-click-rate', 'label': 'Taux de clic'}
]) }}

<div class="dashboard-period-switch">
    <button type="button" class="period-btn active" data-days="">Tout</button>
    <button type="button" class="period-btn" data-days="7">7 jours</button>
    <button type="button" class="period-btn" data-days="30">30 jours</button>
    <button type="button" class="period-btn" data-days="90">90 jours</button>
</div>

<section class="dashboard-section">
    <h2 class="dashboard-section-title">Structure du pipeline</h2>
    <div class="charts-section">
        <div class="chart-card">
            <h3>Répartition par statut</h3>
            <canvas id="chart-statuts"></canvas>
        </div>
        
        <div class="chart-card">
            <h3>Répartition par secteur</h3>
            <canvas id="chart-secteurs"></canvas>
        </div>
    </div>
</section>

<section class="dashboard-section">
    <h2 class="dashboard-section-title">Performance emailing & secteurs gagnés</h2>
    <div class="charts-section">
        <div class="chart-card">
            <h3>Emails envoyés / ouverts / cliqués</h3>
            <canvas id="chart-emails"></canvas>
        </div>
        <div class="chart-card">
            <h3>Top secteurs par prospects gagnés</h3>
            <canvas id="chart-secteurs-gagnes"></canvas>
        </div>
    </div>
</section>

<div class="dashboard-columns">
    <div class="dashboard-card">
        <h2>Derniers prospects gagnés</h2>
        <div id="recent-gagnes" class="dashboard-list">
            <p>Chargement...</p>
        </div>
    </div>
    <div class="dashboard-card">
        <h2>Dernières campagnes email</h2>
        <div id="recent-campagnes" class="dashboard-list">
            <p>Chargement...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>
{% endblock %}

