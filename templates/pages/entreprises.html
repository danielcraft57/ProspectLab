{% extends "base.html" %}

{% block title %}Entreprises - ProspectLab{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Entreprises analysées</h1>
    <p>Gérez vos prospects, ajoutez des tags et des notes</p>
</div>

<div class="filters-section">
    <div class="filters-card">
        <div class="filters-header">
            <div class="filters-title">
                <h3>Recherche d'entreprises</h3>
                <p class="filters-subtitle">Filtrage en temps réel, sans bouton Appliquer.</p>
            </div>
            <button id="btn-toggle-advanced-filters" type="button" class="btn filters-toggle">
                <i class="fas fa-sliders-h" aria-hidden="true"></i>
                <span>Filtres avancés</span>
                <span id="active-filters-count" class="filters-toggle-badge" style="display: none;">0</span>
            </button>
        </div>

        <div class="filters-main-search">
            <label for="search-input" class="filters-main-label">Recherche</label>
            <div class="search-field search-field-large">
                <i class="fas fa-search search-icon" aria-hidden="true"></i>
                <input
                    type="text"
                    id="search-input"
                    class="form-input"
                    placeholder="Nom, secteur, email..."
                    autocomplete="off"
                >
            </div>
        </div>

        <div id="advanced-filters" class="filters-grid filters-advanced collapsed">
            <div class="filter-group">
                <label for="filter-secteur">Secteur</label>
                <select id="filter-secteur" class="form-select">
                    <option value="">Tous les secteurs</option>
                </select>
            </div>

            <!-- Statut: pills interactifs plutôt qu'une simple liste déroulante -->
            <div class="filter-group">
                <label class="filter-label">Statut</label>
                <div id="filter-statut-pills" class="status-pills">
                    <button type="button" class="pill active" data-value="">Tous</button>
                    <button type="button" class="pill" data-value="Prospect intéressant">Prospect intéressant</button>
                    <button type="button" class="pill" data-value="À contacter">À contacter</button>
                    <button type="button" class="pill" data-value="En cours">En cours</button>
                    <button type="button" class="pill" data-value="Clos">Clos</button>
                </div>
                <!-- Champ caché utilisé par le JS pour construire les filtres -->
                <input type="hidden" id="filter-statut" value="">
            </div>

            <!-- Jauges de score sécurité (min / max) -->
            <div class="filter-group">
                <label class="filter-label" for="filter-security-min">Score sécurité</label>
                <div class="score-slider">
                    <div class="score-slider-row">
                        <div class="score-slider-header">
                            <span class="score-slider-label">À partir de</span>
                            <span id="filter-security-min-value" class="score-slider-value">0 (tous)</span>
                        </div>
                        <input
                            type="range"
                            id="filter-security-min"
                            min="0"
                            max="100"
                            step="5"
                            value="0"
                            class="score-range-input"
                        >
                    </div>
                    <div class="score-slider-row">
                        <div class="score-slider-header">
                            <span class="score-slider-label">Jusqu'à</span>
                            <span id="filter-security-max-value" class="score-slider-value">100 (tous)</span>
                        </div>
                        <input
                            type="range"
                            id="filter-security-max"
                            min="0"
                            max="100"
                            step="5"
                            value="100"
                            class="score-range-input"
                        >
                    </div>
                    <div class="score-slider-scale">
                        <span>0</span>
                        <span>25</span>
                        <span>50</span>
                        <span>75</span>
                        <span>100</span>
                    </div>
                </div>
            </div>

            <!-- Jauges de score SEO (min / max) -->
            <div class="filter-group">
                <label class="filter-label" for="filter-seo-min">Score SEO</label>
                <div class="score-slider">
                    <div class="score-slider-row">
                        <div class="score-slider-header">
                            <span class="score-slider-label">À partir de</span>
                            <span id="filter-seo-min-value" class="score-slider-value">0 (tous)</span>
                        </div>
                        <input
                            type="range"
                            id="filter-seo-min"
                            min="0"
                            max="100"
                            step="5"
                            value="0"
                            class="score-range-input"
                        >
                    </div>
                    <div class="score-slider-row">
                        <div class="score-slider-header">
                            <span class="score-slider-label">Jusqu'à</span>
                            <span id="filter-seo-max-value" class="score-slider-value">100 (tous)</span>
                        </div>
                        <input
                            type="range"
                            id="filter-seo-max"
                            min="0"
                            max="100"
                            step="5"
                            value="100"
                            class="score-range-input"
                        >
                    </div>
                    <div class="score-slider-scale">
                        <span>0</span>
                        <span>25</span>
                        <span>50</span>
                        <span>75</span>
                        <span>100</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="filters-actions">
            <span class="filters-hint">Les filtres sont appliqués automatiquement.</span>
        </div>
    </div>
</div>

<div class="results-section">
    <div class="results-header">
        <h3 id="results-count">Chargement...</h3>
        <div class="view-options">
            <button id="btn-view-grid" class="view-btn active" title="Vue grille">
                <i class="fas fa-th"></i>
            </button>
            <button id="btn-view-list" class="view-btn" title="Vue liste">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>
    
    <div id="entreprises-container" class="entreprises-grid">
        <p>Chargement des entreprises...</p>
    </div>
    
    <div id="pagination" class="pagination"></div>
</div>

<!-- Modale de détails d'entreprise -->
<div id="entreprise-modal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2 id="modal-entreprise-nom">Chargement...</h2>
            <button class="modal-close" id="modal-close-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" id="modal-entreprise-body">
            <div class="loading">Chargement des détails...</div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Modules utilitaires (chargement synchrone pour dépendances) -->
<script src="{{ url_for('static', filename='js/modules/utils/formatters.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/utils/badges.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/utils/notifications.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/utils/debounce.js') }}"></script>
<!-- Module API -->
<script src="{{ url_for('static', filename='js/modules/entreprises/api.js') }}"></script>
<!-- Modules d'affichage des analyses -->
<script src="{{ url_for('static', filename='js/modules/analyses/technical.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/analyses/osint.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/analyses/pentest.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/analyses/scraping.js') }}"></script>
<!-- Script principal (chargement différé) -->
<script src="{{ url_for('static', filename='js/entreprises.refactored.js') }}?v=5" defer></script>
{% endblock %}

