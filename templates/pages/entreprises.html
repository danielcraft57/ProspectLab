{% extends "base.html" %}

{% block title %}Entreprises - ProspectLab{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Entreprises analysées</h1>
    <p>Gérez vos prospects, ajoutez des tags et des notes</p>
</div>

<div class="filters-section">
    <div class="filters-card">
        <div class="filters-header">
            <div class="filters-title">
                <h3>Recherche d'entreprises</h3>
                <p class="filters-subtitle">Filtrage en temps réel, sans bouton Appliquer.</p>
            </div>
            <button id="btn-toggle-advanced-filters" type="button" class="btn filters-toggle">
                <i class="fas fa-sliders-h" aria-hidden="true"></i>
                <span>Filtres avancés</span>
                <span id="active-filters-count" class="filters-toggle-badge" style="display: none;">0</span>
            </button>
        </div>

        <div class="filters-main-search">
            <label for="search-input" class="filters-main-label">Recherche</label>
            <div class="search-field search-field-large">
                <i class="fas fa-search search-icon" aria-hidden="true"></i>
                <input
                    type="text"
                    id="search-input"
                    class="form-input"
                    placeholder="Nom, secteur, email..."
                    autocomplete="off"
                >
            </div>
        </div>

        <div id="advanced-filters" class="filters-grid filters-advanced collapsed">
            <div class="filter-group">
                <label for="filter-secteur">Secteur</label>
                <select id="filter-secteur" class="form-select">
                    <option value="">Tous les secteurs</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-statut">Statut</label>
                <select id="filter-statut" class="form-select">
                    <option value="">Tous les statuts</option>
                    <option value="Prospect intéressant">Prospect intéressant</option>
                    <option value="À contacter">À contacter</option>
                    <option value="En cours">En cours</option>
                    <option value="Clos">Clos</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-opportunite">Opportunité</label>
                <select id="filter-opportunite" class="form-select">
                    <option value="">Toutes les opportunités</option>
                    <option value="Très élevée">Très élevée</option>
                    <option value="Élevée">Élevée</option>
                    <option value="Moyenne">Moyenne</option>
                    <option value="Faible">Faible</option>
                    <option value="Très faible">Très faible</option>
                </select>
            </div>

            <div class="filter-group">
                <label>
                    <input type="checkbox" id="filter-favori">
                    Favoris uniquement
                </label>
            </div>
            <div class="filter-group">
                <label for="filter-security-min">Sécurité (min)</label>
                <select id="filter-security-min" class="form-select" title="Score sécurité minimal (0-100)">
                    <option value="">Toute</option>
                    <option value="0">0 - 24</option>
                    <option value="25">25 - 49</option>
                    <option value="50">50 - 74</option>
                    <option value="75">75 - 100</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-security-max">Sécurité (max)</label>
                <select id="filter-security-max" class="form-select" title="Score sécurité maximal (0-100)">
                    <option value="">Toute</option>
                    <option value="24">0 - 24</option>
                    <option value="49">25 - 49</option>
                    <option value="74">50 - 74</option>
                    <option value="100">75 - 100</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-pentest-min">Pentest (min)</label>
                <select id="filter-pentest-min" class="form-select" title="Score pentest (risque) minimal (0-100)">
                    <option value="">Toute</option>
                    <option value="0">0 - 24</option>
                    <option value="25">25 - 49</option>
                    <option value="50">50 - 74</option>
                    <option value="75">75 - 100</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-pentest-max">Pentest (max)</label>
                <select id="filter-pentest-max" class="form-select" title="Score pentest (risque) maximal (0-100)">
                    <option value="">Toute</option>
                    <option value="24">0 - 24</option>
                    <option value="49">25 - 49</option>
                    <option value="74">50 - 74</option>
                    <option value="100">75 - 100</option>
                </select>
            </div>
        </div>

        <div class="filters-actions">
            <span class="filters-hint">Les filtres sont appliqués automatiquement.</span>
        </div>
    </div>
</div>

<div class="results-section">
    <div class="results-header">
        <h3 id="results-count">Chargement...</h3>
        <div class="view-options">
            <button id="btn-view-grid" class="view-btn active" title="Vue grille">
                <i class="fas fa-th"></i>
            </button>
            <button id="btn-view-list" class="view-btn" title="Vue liste">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>
    
    <div id="entreprises-container" class="entreprises-grid">
        <p>Chargement des entreprises...</p>
    </div>
    
    <div id="pagination" class="pagination"></div>
</div>

<!-- Modale de détails d'entreprise -->
<div id="entreprise-modal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2 id="modal-entreprise-nom">Chargement...</h2>
            <button class="modal-close" id="modal-close-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" id="modal-entreprise-body">
            <div class="loading">Chargement des détails...</div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Modules utilitaires (chargement synchrone pour dépendances) -->
<script src="{{ url_for('static', filename='js/modules/utils/formatters.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/utils/badges.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/utils/notifications.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/utils/debounce.js') }}"></script>
<!-- Module API -->
<script src="{{ url_for('static', filename='js/modules/entreprises/api.js') }}"></script>
<!-- Modules d'affichage des analyses -->
<script src="{{ url_for('static', filename='js/modules/analyses/technical.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/analyses/osint.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/analyses/pentest.js') }}"></script>
<script src="{{ url_for('static', filename='js/modules/analyses/scraping.js') }}"></script>
<!-- Script principal (chargement différé) -->
<script src="{{ url_for('static', filename='js/entreprises.refactored.js') }}?v=5" defer></script>
{% endblock %}

