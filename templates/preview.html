{% extends "base.html" %}

{% block title %}Prévisualisation - ProspectLab{% endblock %}

{% block content %}
<div class="page-header" data-filename="{{ filename }}" data-download-file-url="{{ url_for('other.download_file', filename='') }}">
    <h1>Prévisualisation du fichier</h1>
    <p>Fichier : <strong>{{ filename }}</strong> ({{ total_rows }} lignes)</p>
</div>

{% if validation_warnings %}
<div class="info-box" style="background-color: #fff3cd; border-left: 4px solid #ffc107; margin-bottom: 2rem;">
    <h3 style="color: #856404; margin-bottom: 0.5rem;">⚠️ Avertissements de validation</h3>
    <p style="color: #856404; margin-bottom: 0.5rem;">Les erreurs suivantes ont été détectées dans votre fichier. Les lignes concernées seront ignorées lors de l'analyse :</p>
    <ul style="color: #856404; margin-left: 1.5rem;">
        {% for warning in validation_warnings %}
        <li>{{ warning }}</li>
        {% endfor %}
    </ul>
    {% if validation_warnings|length >= 10 %}
    <p style="color: #856404; margin-top: 0.5rem; font-style: italic;">... et d'autres erreurs (seules les 10 premières sont affichées)</p>
    {% endif %}
</div>
{% endif %}

<div class="preview-section">
    <h2>Aperçu des données (10 premières lignes)</h2>
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    {% for col in columns %}
                    <th>{{ col }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in preview %}
                <tr>
                    {% for col in columns %}
                    <td>{{ row.get(col, '') }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="analyze-section">
    <h2>Lancer l'analyse</h2>
    
    <form id="analyze-form" class="analyze-form">
        <div class="form-group">
            <label for="max_workers">Nombre de threads parallèles</label>
            <input type="number" id="max_workers" name="max_workers" value="3" min="1" max="10">
            <small>Plus de threads = analyse plus rapide mais plus de charge sur les serveurs</small>
        </div>
        
        <div class="form-group">
            <label for="delay">Délai entre requêtes (secondes)</label>
            <input type="number" id="delay" name="delay" value="2.0" min="0.5" max="10" step="0.5">
            <small>Délai recommandé : 2 secondes pour éviter les blocages</small>
        </div>
        
        <div class="form-actions" style="display: flex; gap: 1rem; align-items: center;">
            <button type="submit" class="btn btn-primary" id="start-analysis-btn">Lancer l'analyse</button>
            <button type="button" class="btn btn-danger" id="stop-analysis-btn" style="display: none;">Arrêter l'analyse</button>
        </div>
    </form>
    
    <div id="analyze-status" class="status-message" style="display: none;"></div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/preview.js') }}"></script>
{% endblock %}

